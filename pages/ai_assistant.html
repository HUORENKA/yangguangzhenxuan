<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>阳光甄选AI助手</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="../assets/custom.css">
  
  <style>
    :root {
      --color-primary: #2563eb;
      --color-primary-light: #3b82f6;
      --color-primary-bg: #dbeafe;
      --color-primary-border: #93c5fd;
      --color-accent: #6366f1;
      --color-red: #E2231A;
      --gradient-ai: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      /* 整个页面底部背景：浅蓝渐变 + 轻微几何图案，与参考图简洁蓝白风格一致 */
      background: linear-gradient(160deg, #f8fafc 0%, #f1f5f9 25%, #e8ecf4 50%, #e0e7ff 75%, #dbeafe 100%);
      background-image:
        radial-gradient(ellipse 80% 50% at 50% 100%, rgba(59, 130, 246, 0.08) 0%, transparent 55%),
        radial-gradient(circle at 20% 85%, rgba(99, 102, 241, 0.06) 0%, transparent 45%),
        radial-gradient(circle at 80% 90%, rgba(59, 130, 246, 0.05) 0%, transparent 40%),
        repeating-linear-gradient(
          90deg,
          transparent,
          transparent 24px,
          rgba(59, 130, 246, 0.03) 24px,
          rgba(59, 130, 246, 0.03) 25px
        ),
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 24px,
          rgba(99, 102, 241, 0.02) 24px,
          rgba(99, 102, 241, 0.02) 25px
        ),
        linear-gradient(160deg, #f8fafc 0%, #f1f5f9 25%, #e8ecf4 50%, #e0e7ff 75%, #dbeafe 100%);
      background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%;
    }
    
    /* ==================== 顶部导航 ==================== */
    .ai-header {
      background: #fff;
      color: #1e293b;
      padding: 0 24px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      border-bottom: 1px solid #e2e8f0;
    }
    
    .ai-header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .ai-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: var(--color-primary);
    }
    
    .ai-logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
      color: #fff;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    .ai-logo-text {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.5px;
      color: #1e293b;
    }
    
    .ai-header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .ai-user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #475569;
    }
    
    .ai-user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--color-primary-bg);
      color: var(--color-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    /* ==================== 主体布局 ==================== */
    .ai-main {
      flex: 1;
      display: flex;
      min-height: 0;
      padding: 16px;
      gap: 16px;
    }
    
    /* 中+右+底条 整体 */
    .ai-middle-right {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      min-width: 0;
    }
    
    .ai-middle-right-top {
      flex: 1;
      display: flex;
      min-height: 0;
      gap: 16px;
    }
    
    /* 右侧列：AI寻源 + AI询价，与中间 3:4 填满整行 */
    .ai-right-column {
      flex: 3 1 0;
      display: flex;
      flex-direction: column;
      gap: 16px;
      min-height: 0;
      min-width: 0;
    }
    
    .ai-util-panel {
      flex: 1;
      min-height: 0;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      border: 1px solid #e2e8f0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .ai-util-panel-header {
      padding: 12px 16px;
      border-bottom: 1px solid #e2e8f0;
      background: #f8fafc;
      font-size: 14px;
      font-weight: 600;
      color: #1e293b;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ai-util-panel-header i {
      color: var(--color-primary);
    }
    
    .ai-util-panel-body {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      font-size: 13px;
      color: #64748b;
    }
    
    /* 左侧：AI对话导购 */
    .ai-chat-panel {
      flex: 0 0 30%;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      border: 1px solid #e2e8f0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .ai-panel-header {
      padding: 14px 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      gap: 12px;
      background: #f8fafc;
    }
    
    .ai-panel-header-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .ai-panel-header-text h3 {
      font-size: 15px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 2px;
    }
    
    .ai-panel-header-text p {
      font-size: 12px;
      color: #64748b;
    }
    
    .ai-chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .ai-message {
      display: flex;
      gap: 10px;
      max-width: 90%;
    }
    
    .ai-message.user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }
    
    .ai-message.assistant {
      align-self: flex-start;
    }
    
    .ai-message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .ai-message.user .ai-message-avatar {
      background: var(--color-primary-bg);
      color: var(--color-primary);
    }
    
    .ai-message.assistant .ai-message-avatar {
      background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
      color: #fff;
    }
    
    .ai-message-content {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .ai-message-bubble {
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.6;
      word-break: break-word;
    }
    
    .ai-message.user .ai-message-bubble {
      background: var(--color-primary-bg);
      color: #1e40af;
      border: 1px solid var(--color-primary-border);
      border-bottom-right-radius: 4px;
    }
    
    .ai-message.assistant .ai-message-bubble {
      background: #f1f5f9;
      color: #334155;
      border: 1px solid #e2e8f0;
      border-bottom-left-radius: 4px;
    }
    
    .ai-message-options-label {
      font-size: 12px;
      color: #64748b;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .ai-message-options-label i {
      font-size: 10px;
      color: #94a3b8;
    }
    
    .ai-message-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .ai-option-btn {
      padding: 8px 14px;
      border-radius: 16px;
      font-size: 13px;
      border: 1px solid #e2e8f0;
      background: #fff;
      color: #475569;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .ai-option-btn:hover {
      border-color: var(--color-primary);
      color: var(--color-primary);
      background: var(--color-primary-bg);
    }
    
    /* 对话区功能切换按钮 */
    .ai-chat-func-tabs {
      display: flex;
      gap: 8px;
      padding: 12px 16px;
      border-top: 1px solid #e2e8f0;
      background: #f8fafc;
      flex-wrap: wrap;
    }
    
    .ai-chat-func-tab {
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      border: 1px solid #e2e8f0;
      background: #fff;
      color: #64748b;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .ai-chat-func-tab.active {
      border-color: var(--color-primary);
      background: var(--color-primary-bg);
      color: var(--color-primary);
    }
    
    .ai-chat-func-tab:hover:not(.active) {
      border-color: #cbd5e1;
      color: #475569;
    }
    
    .ai-chat-input-wrap {
      padding: 16px;
      border-top: 1px solid #e2e8f0;
      background: #fff;
    }
    
    .ai-chat-input {
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }
    
    .ai-chat-input input {
      flex: 1;
      min-height: 48px;
      padding: 12px 18px;
      border: 1px solid #e2e8f0;
      border-radius: 24px;
      font-size: 14px;
      outline: none;
      transition: all 0.2s;
      background: #f8fafc;
    }
    
    .ai-chat-input input:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
      background: #fff;
    }
    
    .ai-chat-input button {
      width: 48px;
      height: 48px;
      min-width: 48px;
      border-radius: 50%;
      background: var(--color-primary);
      color: #fff;
      border: none;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.35);
    }
    
    .ai-chat-input button:hover {
      background: var(--color-primary-light);
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    
    .ai-chat-input-upload {
      flex-shrink: 0;
      width: 48px;
      height: 48px;
      min-width: 48px;
      border-radius: 50%;
      background: #f1f5f9;
      color: #64748b;
      border: 1px solid #e2e8f0;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .ai-chat-input-upload:hover {
      background: var(--color-primary-bg);
      color: var(--color-primary);
      border-color: var(--color-primary-border);
    }
    
    .ai-chat-input-upload input[type="file"] {
      position: absolute;
      width: 0;
      height: 0;
      opacity: 0;
      overflow: hidden;
    }
    
    /* 中间：智能分析页（搜索结果），与右侧 4:3 填满整行 */
    .ai-analysis-panel {
      flex: 4 1 0;
      min-width: 0;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      border: 1px solid #e2e8f0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .ai-analysis-header {
      padding: 14px 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      gap: 12px;
      background: #f8fafc;
    }
    
    .ai-analysis-header .ai-panel-header-icon {
      background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
    }
    
    .ai-analysis-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    
    .ai-analysis-empty {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      text-align: center;
      padding: 40px;
    }
    
    .ai-analysis-empty-icon {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #e0e7ff 0%, #dbeafe 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: var(--color-primary-border);
      margin-bottom: 16px;
    }
    
    .ai-analysis-empty h4 {
      font-size: 16px;
      color: #6b7280;
      margin-bottom: 8px;
    }
    
    .ai-analysis-empty p {
      font-size: 13px;
      line-height: 1.6;
    }
    
    /* 分析内容 - 商品卡片 */
    .ai-product-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    .ai-product-card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 14px;
      transition: all 0.2s;
      cursor: pointer;
      position: relative;
    }
    
    .ai-product-card:hover {
      border-color: var(--color-primary-border);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.12);
      transform: translateY(-2px);
    }
    
    .ai-product-card-icon {
      width: 48px;
      height: 48px;
      margin: 0 auto 12px;
      border-radius: 12px;
      background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
      color: var(--color-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    }
    
    .ai-product-card-img {
      width: 100%;
      aspect-ratio: 4/3;
      object-fit: cover;
      border-radius: 8px;
      background: #f3f4f6;
      margin-bottom: 10px;
    }
    
    .ai-product-card-name {
      font-size: 13px;
      color: #1f2937;
      line-height: 1.4;
      margin-bottom: 6px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .ai-product-card-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .ai-product-card-price {
      font-size: 16px;
      color: var(--color-primary);
      font-weight: 600;
    }
    
    .ai-product-card-suppliers {
      font-size: 12px;
      color: #64748b;
    }
    
    .ai-product-card-score {
      font-size: 12px;
      color: #6b7280;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .ai-product-card-score i {
      color: #fbbf24;
    }
    
    .ai-product-card-actions {
      display: flex;
      gap: 8px;
    }
    
    .ai-btn-sm {
      flex: 1;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }
    
    .ai-btn-sm.primary {
      background: var(--color-primary);
      color: #fff;
    }
    
    .ai-btn-sm.primary:hover {
      background: var(--color-primary-light);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.35);
    }
    
    .ai-btn-sm.secondary {
      background: #f3f4f6;
      color: #374151;
    }
    
    .ai-btn-sm.secondary:hover {
      background: #e5e7eb;
    }
    
    /* 比价表格 */
    .ai-compare-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-bottom: 16px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
    }
    
    .ai-compare-table th,
    .ai-compare-table td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .ai-compare-table th {
      background: linear-gradient(135deg, #f8f9ff 0%, #f3f4f6 100%);
      font-weight: 600;
      color: #374151;
    }
    
    .ai-compare-table td {
      color: #4b5563;
    }
    
    .ai-compare-table tr:last-child td {
      border-bottom: none;
    }
    
    .ai-compare-table .highlight {
      color: var(--color-primary);
      font-weight: 600;
    }
    
    /* 评价列表 */
    .ai-review-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .ai-review-tab {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .ai-review-tab.positive {
      background: #dcfce7;
      color: #166534;
    }
    
    .ai-review-tab.positive.active {
      background: #10b981;
      color: #fff;
    }
    
    .ai-review-tab.negative {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .ai-review-tab.negative.active {
      background: #ef4444;
      color: #fff;
    }
    
    .ai-review-item {
      padding: 12px;
      background: #f9fafb;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .ai-review-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .ai-review-user {
      font-size: 13px;
      color: #374151;
      font-weight: 500;
    }
    
    .ai-review-tag {
      padding: 2px 10px;
      border-radius: 10px;
      font-size: 11px;
    }
    
    .ai-review-tag.positive {
      background: #dcfce7;
      color: #166534;
    }
    
    .ai-review-tag.negative {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .ai-review-content {
      font-size: 13px;
      color: #6b7280;
      line-height: 1.6;
    }
    
    /* 底条内商品项（复用原快捷项样式） */
    .ai-quick-item {
      display: flex;
      gap: 12px;
      padding: 12px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      margin-bottom: 12px;
      transition: all 0.2s;
    }
    
    .ai-quick-item:hover {
      border-color: var(--color-primary-border);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.12);
    }
    
    .ai-quick-item-img {
      width: 64px;
      height: 64px;
      border-radius: 8px;
      object-fit: cover;
      background: #f3f4f6;
      flex-shrink: 0;
    }
    
    .ai-quick-item-info {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .ai-quick-item-name {
      font-size: 13px;
      color: #1f2937;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .ai-quick-item-bottom {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .ai-quick-item-price {
      font-size: 14px;
      color: var(--color-primary);
      font-weight: 600;
    }
    
    .ai-quick-item-send {
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
      background: var(--color-primary);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .ai-quick-item-send:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.35);
    }
    
    /* 加载动画 */
    .ai-loading {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #9ca3af;
    }
    
    .ai-loading-dots {
      display: flex;
      gap: 4px;
    }
    
    .ai-loading-dots span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--color-primary);
      animation: ai-bounce 1.4s infinite ease-in-out both;
    }
    
    .ai-loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .ai-loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes ai-bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }
    
    /* Toast 提示 */
    .ai-toast {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      padding: 12px 24px;
      background: rgba(0,0,0,0.8);
      color: #fff;
      border-radius: 8px;
      font-size: 14px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .ai-toast.show {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }
    
    /* 分析内容标题 */
    .ai-section-title {
      font-size: 14px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ai-section-title i {
      color: var(--color-primary);
    }
    
    /* 预算标签 */
    .ai-budget-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: #dcfce7;
      color: #166534;
      font-size: 11px;
      border-radius: 12px;
      margin-bottom: 8px;
    }
    
    /* 评价摘要 */
    .ai-review-summary {
      padding: 16px;
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      border-radius: 12px;
      margin-bottom: 16px;
    }
    
    .ai-review-summary-title {
      font-size: 14px;
      font-weight: 600;
      color: #166534;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ai-review-summary-content {
      font-size: 13px;
      color: #15803d;
      line-height: 1.6;
    }
    
    /* 订单确认卡片 */
    .ai-order-card {
      border: 2px solid #10b981;
      border-radius: 12px;
      padding: 16px;
      background: linear-gradient(135deg, #f0fdf4 0%, #fff 100%);
    }
    
    .ai-order-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 12px;
      border-bottom: 1px dashed #d1fae5;
      margin-bottom: 12px;
    }
    
    .ai-order-card-img {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      object-fit: cover;
      background: #f3f4f6;
    }
    
    .ai-order-card-info {
      flex: 1;
    }
    
    .ai-order-card-name {
      font-size: 14px;
      color: #1f2937;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    
    .ai-order-card-meta {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: #6b7280;
    }
    
    .ai-order-card-total {
      text-align: right;
      margin-bottom: 16px;
    }
    
    .ai-order-card-total span {
      font-size: 13px;
      color: #6b7280;
    }
    
    .ai-order-card-total strong {
      font-size: 20px;
      color: #E2231A;
      margin-left: 8px;
    }
    
    .ai-order-btn {
      width: 100%;
      padding: 14px;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .ai-order-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4);
    }
    
    /* 底条：购物车/我的收藏（横跨中+右，左 Tab + 中内容 + 右收起/展开） */
    .ai-bottom-bar {
      flex-shrink: 0;
      margin-top: 16px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(226, 232, 240, 0.9);
      border-radius: 12px;
      display: flex;
      align-items: stretch;
      min-height: 116px;
      transition: min-height 0.25s ease;
      overflow: hidden;
    }
    
    .ai-bottom-bar.collapsed {
      min-height: 44px;
    }
    
    .ai-bottom-bar.collapsed .ai-bottom-bar-content {
      display: none;
    }
    
    /* 收起时：左侧两按钮横向排列 */
    .ai-bottom-bar.collapsed .ai-bottom-bar-tabs {
      flex-direction: row;
      align-items: center;
      padding: 0 16px;
    }
    
    .ai-bottom-bar-tabs {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 0 16px;
      border-right: 1px solid #e2e8f0;
      background: #f8fafc;
    }
    
    /* 展开时：左侧两按钮上下排列 */
    .ai-bottom-bar:not(.collapsed) .ai-bottom-bar-tabs {
      flex-direction: column;
      align-items: stretch;
      padding: 8px 16px;
      gap: 4px;
    }
    
    .ai-bottom-bar-tab {
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 500;
      color: #64748b;
      background: none;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .ai-bottom-bar-tab.active {
      color: var(--color-primary);
      background: var(--color-primary-bg);
    }
    
    .ai-bottom-bar-tab:hover:not(.active) {
      color: #475569;
      background: #f1f5f9;
    }
    
    .ai-bottom-bar-content {
      flex: 1;
      min-width: 0;
      overflow-x: auto;
      overflow-y: hidden;
      padding: 10px 12px;
      display: flex;
      align-items: stretch;
      gap: 12px;
    }
    
    .ai-bottom-bar-content #favoritesTab,
    .ai-bottom-bar-content #cartTab {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      min-width: 0;
      overflow-x: auto;
    }
    
    /* 收起/展开按钮始终在模块右侧：用 margin-left: auto 顶到右侧 */
    .ai-bottom-bar-toggle {
      flex-shrink: 0;
      margin-left: auto;
      padding: 0 16px;
      border-left: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
    }
    
    .ai-bottom-bar-toggle-btn {
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 500;
      color: #64748b;
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .ai-bottom-bar-toggle-btn:hover {
      color: var(--color-primary);
      border-color: var(--color-primary-border);
      background: var(--color-primary-bg);
    }
    
    /* 底条内商品项：展开时较大卡片，横向排列 */
    .ai-bottom-bar .ai-quick-item {
      flex-shrink: 0;
      width: 240px;
      margin-bottom: 0;
      padding: 12px 14px;
      align-items: center;
    }
    
    .ai-bottom-bar .ai-quick-item-img {
      width: 56px;
      height: 56px;
      border-radius: 8px;
    }
    
    .ai-bottom-bar .ai-quick-item-info {
      gap: 6px;
    }
    
    .ai-bottom-bar .ai-quick-item-name {
      -webkit-line-clamp: 2;
      font-size: 13px;
      line-height: 1.4;
    }
    
    .ai-bottom-bar .ai-quick-item-price {
      font-size: 14px;
    }
    
    .ai-bottom-bar .ai-quick-item-send {
      padding: 6px 12px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <!-- ==================== 顶部导航 ==================== -->
  <header class="ai-header">
    <div class="ai-header-left">
      <a href="home.html" target="_blank" class="ai-logo">
        <div class="ai-logo-icon"><i class="fas fa-robot"></i></div>
        <span class="ai-logo-text">阳光甄选AI助手</span>
      </a>
    </div>
    <div class="ai-header-right">
      <div class="ai-user-info">
        <div class="ai-user-avatar"><i class="fas fa-user"></i></div>
        <span id="userNameDisplay">张三（采购专员）</span>
      </div>
    </div>
  </header>
  
  <!-- ==================== 主体三栏布局 ==================== -->
  <main class="ai-main">
    <!-- 左侧：对话页面 -->
    <section class="ai-chat-panel">
      <div class="ai-panel-header">
        <div class="ai-panel-header-icon"><i class="fas fa-infinity"></i></div>
        <div class="ai-panel-header-text">
          <h3>AI对话导购</h3>
          <p>有问题随时问我</p>
        </div>
      </div>
      <div class="ai-chat-messages" id="chatMessages">
        <!-- 欢迎消息 -->
        <div class="ai-message assistant">
          <div class="ai-message-avatar"><i class="fas fa-robot"></i></div>
          <div class="ai-message-content">
            <div class="ai-message-bubble">
              您好！我是阳光优采智能助手。<br><br>
              我可以帮您：<br>
              <strong>• 找商品</strong>：推荐商品、预算筛选、查看评价<br>
              <strong>• 做决策</strong>：比质比价、收藏商品、快速下单<br>
              <strong>• 解疑问</strong>：平台规则咨询<br><br>
              请问有什么可以帮您的？
            </div>
            <div class="ai-message-options-label">
              <span>相关提问建议</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="ai-message-options">
              <button class="ai-option-btn" onclick="sendQuickMsg('有没有好用的复印纸？')">找复印纸</button>
              <button class="ai-option-btn" onclick="sendQuickMsg('200元内采购10箱A4复印纸')">预算内采购</button>
              <button class="ai-option-btn" onclick="sendQuickMsg('商品如何结算？')">规则咨询</button>
            </div>
          </div>
        </div>
      </div>
      <div class="ai-chat-func-tabs">
        <button type="button" class="ai-chat-func-tab active"><i class="fas fa-search"></i> 商品查询</button>
        <button type="button" class="ai-chat-func-tab"><i class="fas fa-chart-line"></i> 价格分析</button>
        <button type="button" class="ai-chat-func-tab"><i class="fas fa-book"></i> 规则咨询</button>
        <button type="button" class="ai-chat-func-tab"><i class="fas fa-ellipsis-h"></i> 更多</button>
      </div>
      <div class="ai-chat-input-wrap">
        <div class="ai-chat-input">
          <label class="ai-chat-input-upload" title="上传采购单">
            <i class="fas fa-file-upload"></i>
            <input type="file" id="procurementFile" accept=".xlsx,.xls,.csv,.pdf,.txt" onchange="onProcurementFileChange(this)">
          </label>
          <input type="text" id="chatInput" placeholder="请输入问题..." onkeypress="if(event.key==='Enter')sendMessage()">
          <button type="button" onclick="sendMessage()" title="发送"><i class="fas fa-paper-plane"></i></button>
        </div>
      </div>
    </section>
    
    <!-- 中+右+底条 -->
    <div class="ai-middle-right">
      <div class="ai-middle-right-top">
    <!-- 中间：智能分析页 -->
    <section class="ai-analysis-panel">
      <div class="ai-analysis-header">
        <div style="display: flex; align-items: center; gap: 12px;">
          <div class="ai-panel-header-icon"><i class="fas fa-search"></i></div>
          <div class="ai-panel-header-text">
            <h3>智能分析</h3>
            <p>商品推荐与数据分析</p>
          </div>
        </div>
      </div>
      <div class="ai-analysis-content" id="analysisContent">
        <!-- 空状态 -->
        <div class="ai-analysis-empty" id="analysisEmpty">
          <div class="ai-analysis-empty-icon"><i class="fas fa-lightbulb"></i></div>
          <h4>等待您的提问</h4>
          <p>向 AI 提问后，这里将展示<br>相关商品推荐和数据分析</p>
        </div>
      </div>
    </section>
    
    <!-- 右侧：AI寻源 + AI询价 -->
    <div class="ai-right-column">
      <section class="ai-util-panel" id="aiSourcingPanel">
        <div class="ai-util-panel-header"><i class="fas fa-search-plus"></i> AI寻源</div>
        <div class="ai-util-panel-body">根据对话内容智能推荐供应商与货源，结果将在此展示。</div>
      </section>
      <section class="ai-util-panel" id="aiInquiryPanel">
        <div class="ai-util-panel-header"><i class="fas fa-file-invoice-dollar"></i> AI询价</div>
        <div class="ai-util-panel-body">询价记录与报价结果将在此展示。</div>
      </section>
    </div>
      </div>
      
      <!-- 底条：购物车/我的收藏（Tab 左 + 内容中 + 收起/展开 右） -->
      <div class="ai-bottom-bar" id="aiBottomBar">
        <div class="ai-bottom-bar-tabs">
          <button type="button" class="ai-bottom-bar-tab active" data-tab="favorites" onclick="switchQuickTab('favorites')"><i class="fas fa-heart"></i> 我的收藏</button>
          <button type="button" class="ai-bottom-bar-tab" data-tab="cart" onclick="switchQuickTab('cart')"><i class="fas fa-shopping-cart"></i> 购物车</button>
        </div>
        <div class="ai-bottom-bar-content" id="quickContent">
          <div id="favoritesTab">
            <div class="ai-quick-item">
              <img src="https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=200&h=200&fit=crop" class="ai-quick-item-img" alt="">
              <div class="ai-quick-item-info">
                <div class="ai-quick-item-name">齐心 C3674-5 A4复印纸 70g 500张/包</div>
                <div class="ai-quick-item-bottom">
                  <span class="ai-quick-item-price">¥25.92</span>
                  <button class="ai-quick-item-send" onclick="sendProductQuery('齐心 C3674-5 A4复印纸')">发送</button>
                </div>
              </div>
            </div>
            <div class="ai-quick-item">
              <img src="https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=200&h=200&fit=crop" class="ai-quick-item-img" alt="">
              <div class="ai-quick-item-info">
                <div class="ai-quick-item-name">天章复印纸 A4 80g 白色 500张/包</div>
                <div class="ai-quick-item-bottom">
                  <span class="ai-quick-item-price">¥28.50</span>
                  <button class="ai-quick-item-send" onclick="sendProductQuery('天章复印纸 A4 80g')">发送</button>
                </div>
              </div>
            </div>
            <div class="ai-quick-item">
              <img src="https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=200&h=200&fit=crop" class="ai-quick-item-img" alt="">
              <div class="ai-quick-item-info">
                <div class="ai-quick-item-name">星宇 劳保手套 防穿刺 防滑耐磨</div>
                <div class="ai-quick-item-bottom">
                  <span class="ai-quick-item-price">¥59.10</span>
                  <button class="ai-quick-item-send" onclick="sendProductQuery('星宇 劳保手套')">发送</button>
                </div>
              </div>
            </div>
          </div>
          <div id="cartTab" style="display: none;">
            <div class="ai-quick-item">
              <img src="https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=200&h=200&fit=crop" class="ai-quick-item-img" alt="">
              <div class="ai-quick-item-info">
                <div class="ai-quick-item-name">得力 A4复印纸 70g 办公用纸 500张/包</div>
                <div class="ai-quick-item-bottom">
                  <span class="ai-quick-item-price">¥23.80 × 5</span>
                  <button class="ai-quick-item-send" onclick="sendProductQuery('得力 A4复印纸')">发送</button>
                </div>
              </div>
            </div>
            <div class="ai-quick-item">
              <img src="https://images.unsplash.com/photo-1582555172866-f73bb12a2ab3?w=200&h=200&fit=crop" class="ai-quick-item-img" alt="">
              <div class="ai-quick-item-info">
                <div class="ai-quick-item-name">唐丰 安全帽 ABS-V型 蓝色</div>
                <div class="ai-quick-item-bottom">
                  <span class="ai-quick-item-price">¥17.70 × 10</span>
                  <button class="ai-quick-item-send" onclick="sendProductQuery('唐丰 安全帽')">发送</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="ai-bottom-bar-toggle">
          <button type="button" class="ai-bottom-bar-toggle-btn" id="aiBottomBarToggle" onclick="toggleBottomBar()"><i class="fas fa-chevron-down"></i> 收起</button>
        </div>
      </div>
    </div>
  </main>
  
  <!-- Toast 提示 -->
  <div class="ai-toast" id="toast"></div>
  
  <script>
    // ==================== Mock 数据 ====================
    const mockProducts = [
      { id: 1, name: '齐心 C3674-5 A4复印纸 70g 500张/包', brand: '齐心', price: 25.92, unit: '包', sales: 8520, score: 4.8, img: 'https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=400&h=300&fit=crop' },
      { id: 2, name: '天章复印纸 A4 80g 白色 500张/包', brand: '天章', price: 28.50, unit: '包', sales: 6230, score: 4.7, img: 'https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=400&h=300&fit=crop' },
      { id: 3, name: '得力 A4复印纸 70g 办公用纸 500张/包', brand: '得力', price: 23.80, unit: '包', sales: 12350, score: 4.9, img: 'https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=400&h=300&fit=crop' },
      { id: 4, name: '星宇 劳保手套 防穿刺 防滑耐磨', brand: '星宇', price: 59.10, unit: '双', sales: 3280, score: 4.6, img: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400&h=300&fit=crop' },
      { id: 5, name: '唐丰 安全帽 ABS-V型 蓝色', brand: '唐丰', price: 17.70, unit: '顶', sales: 5620, score: 4.5, img: 'https://images.unsplash.com/photo-1582555172866-f73bb12a2ab3?w=400&h=300&fit=crop' },
    ];
    
    const mockReviews = {
      positive: [
        { user: '采购员小李', content: '纸张质量很好，打印清晰，物流很快！' },
        { user: '办公室王经理', content: '一直用这个牌子，性价比很高，推荐！' },
        { user: '张先生', content: '包装完好，纸张厚度合适，非常满意。' },
      ],
      negative: [
        { user: '匿名用户', content: '物流有点慢，等了5天才到。' },
        { user: '采购部小陈', content: '有一包纸边角有点破损，希望加强包装。' },
      ]
    };
    
    // ==================== 核心函数 ====================
    
    // 发送快捷消息
    function sendQuickMsg(msg) {
      document.getElementById('chatInput').value = msg;
      sendMessage();
    }
    
    // 发送商品查询（从右侧快捷操作发送）
    function sendProductQuery(productName) {
      addMessage(productName, 'user');
      showLoading();
      
      setTimeout(() => {
        hideLoading();
        // AI 回复
        addMessageWithOptions(
          `好的，我来帮您了解「${productName}」这款商品。请问您想：`,
          [
            { label: '查看商品详情', action: `showProductDetail('${productName}')` },
            { label: '查看评价', action: `showReviews('${productName}')` },
            { label: '与其他商品比价', action: `showCompare('${productName}')` },
            { label: '直接下单', action: `showOrder('${productName}')` },
          ]
        );
        // 在分析区显示商品信息
        showProductAnalysis(productName);
      }, 600);
    }
    
    // 发送消息
    function sendMessage() {
      const input = document.getElementById('chatInput');
      const msg = (input.value || '').trim();
      if (!msg) return;
      
      addMessage(msg, 'user');
      input.value = '';
      
      showLoading();
      
      setTimeout(() => {
        hideLoading();
        processMessage(msg);
      }, 800 + Math.random() * 400);
    }
    
    // 上传采购单
    function onProcurementFileChange(inputEl) {
      var file = inputEl && inputEl.files && inputEl.files[0];
      if (!file) return;
      var fileName = file.name;
      addMessage('已上传采购单：' + fileName, 'user');
      showToast('已上传采购单：' + fileName);
      showLoading();
      setTimeout(function() {
        hideLoading();
        addMessageWithOptions(
          '已收到您的采购单「' + fileName + '」，正在为您解析。您可以：',
          [
            { label: '按采购单推荐商品', action: "sendQuickMsg('根据采购单推荐商品')" },
            { label: '比价询价', action: "sendQuickMsg('对采购单商品比价询价')" },
            { label: '查看解析结果', action: "sendQuickMsg('采购单解析结果')" },
          ]
        );
      }, 600);
      inputEl.value = '';
    }
    
    // 添加消息
    function addMessage(content, type) {
      const container = document.getElementById('chatMessages');
      const msgDiv = document.createElement('div');
      msgDiv.className = `ai-message ${type}`;
      
      const avatarIcon = type === 'user' ? 'fa-user' : 'fa-robot';
      
      msgDiv.innerHTML = `
        <div class="ai-message-avatar"><i class="fas ${avatarIcon}"></i></div>
        <div class="ai-message-content">
          <div class="ai-message-bubble">${content}</div>
        </div>
      `;
      
      container.appendChild(msgDiv);
      container.scrollTop = container.scrollHeight;
    }
    
    // 添加带选项的消息
    function addMessageWithOptions(content, options) {
      const container = document.getElementById('chatMessages');
      const msgDiv = document.createElement('div');
      msgDiv.className = 'ai-message assistant';
      
      const optionsHtml = options.map(o => 
        `<button class="ai-option-btn" onclick="${o.action}">${o.label}</button>`
      ).join('');
      
      msgDiv.innerHTML = `
        <div class="ai-message-avatar"><i class="fas fa-robot"></i></div>
        <div class="ai-message-content">
          <div class="ai-message-bubble">${content}</div>
          <div class="ai-message-options-label"><span>相关提问建议</span><i class="fas fa-chevron-down"></i></div>
          <div class="ai-message-options">${optionsHtml}</div>
        </div>
      `;
      
      container.appendChild(msgDiv);
      container.scrollTop = container.scrollHeight;
    }
    
    // 显示/隐藏加载
    function showLoading() {
      const container = document.getElementById('chatMessages');
      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'ai-message assistant';
      loadingDiv.id = 'loadingMsg';
      loadingDiv.innerHTML = `
        <div class="ai-message-avatar"><i class="fas fa-robot"></i></div>
        <div class="ai-message-content">
          <div class="ai-loading">
            <div class="ai-loading-dots"><span></span><span></span><span></span></div>
            <span>正在思考...</span>
          </div>
        </div>
      `;
      container.appendChild(loadingDiv);
      container.scrollTop = container.scrollHeight;
    }
    
    function hideLoading() {
      const loading = document.getElementById('loadingMsg');
      if (loading) loading.remove();
    }
    
    // 处理消息
    function processMessage(msg) {
      const msgLower = msg.toLowerCase();
      
      // 商品推荐
      if (msgLower.includes('复印纸') || msgLower.includes('打印纸') || msgLower.includes('纸')) {
        addMessageWithOptions(
          '请问您需要什么规格的复印纸？',
          [
            { label: 'A4 70g', action: "selectSpec('A4 70g')" },
            { label: 'A4 80g', action: "selectSpec('A4 80g')" },
            { label: 'A5 70g', action: "selectSpec('A5 70g')" },
          ]
        );
        return;
      }
      
      // 预算筛选
      if (msgLower.includes('元') && (msgLower.includes('采购') || msgLower.includes('预算'))) {
        const budgetMatch = msg.match(/(\d+)\s*元/);
        const budget = budgetMatch ? parseInt(budgetMatch[1]) : 200;
        addMessage(`为您找到预算 ${budget} 元内的商品，请查看右侧分析区域：`, 'assistant');
        showBudgetProducts(budget);
        return;
      }
      
      // 评价查询
      if (msgLower.includes('评价') || msgLower.includes('好评') || msgLower.includes('差评')) {
        addMessage('该商品好评率 <strong>92%</strong>，负面评价主要集中在物流速度方面。详情请看右侧分析区域。', 'assistant');
        showReviewsAnalysis();
        return;
      }
      
      // 比价
      if (msgLower.includes('比') || msgLower.includes('对比') || msgLower.includes('哪个更好')) {
        addMessage('根据对比分析，<strong>得力 A4复印纸</strong> 在性价比方面表现最佳。详情请看右侧分析区域。', 'assistant');
        showCompareAnalysis();
        return;
      }
      
      // 规则咨询
      if (msgLower.includes('结算') || msgLower.includes('付款') || msgLower.includes('支付')) {
        addMessage(`<strong>商品结算方式：</strong><br><br>
          <strong>1. 在线支付</strong><br>
          支持支付宝、微信支付、银联等多种支付方式。<br><br>
          <strong>2. 对公转账</strong><br>
          适用于企业客户，下单后生成对公账户信息。<br><br>
          <strong>3. 账期结算</strong><br>
          通过信用评估的企业客户可申请账期。`, 'assistant');
        clearAnalysis();
        return;
      }
      
      if (msgLower.includes('退货') || msgLower.includes('退换')) {
        addMessage(`<strong>退货规则说明：</strong><br><br>
          <strong>1. 退货时限</strong>：签收后 7 天内可申请无理由退货<br><br>
          <strong>2. 退货条件</strong>：商品需保持原包装完好<br><br>
          <strong>3. 退款时效</strong>：审核通过后 3-5 个工作日内原路退回`, 'assistant');
        clearAnalysis();
        return;
      }
      
      // 默认回复
      addMessageWithOptions(
        '抱歉，我没有完全理解您的问题。您可以尝试以下操作：',
        [
          { label: '找复印纸', action: "sendQuickMsg('有没有好用的复印纸？')" },
          { label: '预算采购', action: "sendQuickMsg('200元内采购10箱A4复印纸')" },
          { label: '查看评价', action: "sendQuickMsg('这个商品评价怎么样？')" },
          { label: '规则咨询', action: "sendQuickMsg('商品如何结算？')" },
        ]
      );
    }
    
    // 选择规格
    function selectSpec(spec) {
      addMessage(spec, 'user');
      setTimeout(() => {
        addMessage(`为您推荐以下 ${spec} 复印纸，请查看右侧分析区域：`, 'assistant');
        showProductsAnalysis();
      }, 500);
    }
    
    // ==================== 分析区显示函数 ====================
    
    function clearAnalysis() {
      document.getElementById('analysisContent').innerHTML = `
        <div class="ai-analysis-empty" id="analysisEmpty">
          <div class="ai-analysis-empty-icon"><i class="fas fa-lightbulb"></i></div>
          <h4>等待您的提问</h4>
          <p>向 AI 提问后，这里将展示<br>相关商品推荐和数据分析</p>
        </div>
      `;
    }
    
    function showProductsAnalysis() {
      const products = mockProducts.filter(p => p.name.includes('纸')).slice(0, 4);
      const html = `
        <div class="ai-section-title"><i class="fas fa-box-open"></i> 推荐商品</div>
        <div class="ai-product-grid">
          ${products.map(p => `
            <div class="ai-product-card" onclick="showProductDetail('${p.name}')">
              <div class="ai-product-card-icon"><i class="fas fa-shopping-cart"></i></div>
              <img src="${p.img}" class="ai-product-card-img" alt="">
              <div class="ai-product-card-name">${p.name}</div>
              <div class="ai-product-card-meta">
                <span class="ai-product-card-price">¥${p.price.toFixed(2)}/${p.unit}</span>
                <span class="ai-product-card-suppliers">${p.sales} 销量</span>
              </div>
              <div class="ai-product-card-actions">
                <button class="ai-btn-sm primary" onclick="event.stopPropagation();addToCart(${p.id})"><i class="fas fa-cart-plus"></i> 加购</button>
                <button class="ai-btn-sm secondary" onclick="event.stopPropagation();addToFavorite(${p.id})"><i class="fas fa-heart"></i></button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
    }
    
    function showProductAnalysis(productName) {
      const product = mockProducts.find(p => p.name.includes(productName.split(' ')[0])) || mockProducts[0];
      const html = `
        <div class="ai-section-title"><i class="fas fa-info-circle"></i> 商品信息</div>
        <div class="ai-product-card" style="margin-bottom: 16px;">
          <div class="ai-product-card-icon"><i class="fas fa-shopping-cart"></i></div>
          <img src="${product.img}" class="ai-product-card-img" alt="">
          <div class="ai-product-card-name">${product.name}</div>
          <div class="ai-product-card-meta">
            <span class="ai-product-card-price">¥${product.price.toFixed(2)}/${product.unit}</span>
            <span class="ai-product-card-suppliers"><i class="fas fa-star"></i> ${product.score} | 销量 ${product.sales}</span>
          </div>
          <div class="ai-product-card-actions">
            <button class="ai-btn-sm primary" onclick="addToCart(${product.id})"><i class="fas fa-cart-plus"></i> 加入购物车</button>
            <button class="ai-btn-sm secondary" onclick="addToFavorite(${product.id})"><i class="fas fa-heart"></i> 收藏</button>
          </div>
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
    }
    
    function showBudgetProducts(budget) {
      const products = mockProducts.filter(p => p.price * 10 <= budget).slice(0, 4);
      const html = `
        <div class="ai-section-title"><i class="fas fa-wallet"></i> 预算内商品</div>
        <div class="ai-product-grid">
          ${products.map(p => `
            <div class="ai-product-card">
              <div class="ai-budget-tag"><i class="fas fa-check-circle"></i> 预算内</div>
              <div class="ai-product-card-icon"><i class="fas fa-shopping-cart"></i></div>
              <img src="${p.img}" class="ai-product-card-img" alt="">
              <div class="ai-product-card-name">${p.name}</div>
              <div class="ai-product-card-meta">
                <span class="ai-product-card-price">¥${p.price.toFixed(2)}/${p.unit}</span>
                <span class="ai-product-card-suppliers">10箱 ¥${(p.price * 10).toFixed(2)}</span>
              </div>
              <div class="ai-product-card-actions">
                <button class="ai-btn-sm primary" onclick="showOrderConfirm(${p.id}, 10)"><i class="fas fa-bolt"></i> 一键下单</button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
    }
    
    function showReviewsAnalysis() {
      const html = `
        <div class="ai-section-title"><i class="fas fa-star"></i> 商品评价</div>
        <div class="ai-review-summary">
          <div class="ai-review-summary-title"><i class="fas fa-chart-pie"></i> 评价摘要</div>
          <div class="ai-review-summary-content">好评率 <strong>92%</strong>，负面评价主要集中在物流速度方面。整体质量稳定，值得推荐。</div>
        </div>
        <div class="ai-review-tabs">
          <button class="ai-review-tab positive active" onclick="showPositiveReviews()">好评 (${mockReviews.positive.length})</button>
          <button class="ai-review-tab negative" onclick="showNegativeReviews()">差评 (${mockReviews.negative.length})</button>
        </div>
        <div id="reviewsList">
          ${mockReviews.positive.map(r => `
            <div class="ai-review-item">
              <div class="ai-review-header">
                <span class="ai-review-user">${r.user}</span>
                <span class="ai-review-tag positive">好评</span>
              </div>
              <div class="ai-review-content">${r.content}</div>
            </div>
          `).join('')}
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
    }
    
    function showPositiveReviews() {
      document.querySelectorAll('.ai-review-tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.ai-review-tab.positive').classList.add('active');
      document.getElementById('reviewsList').innerHTML = mockReviews.positive.map(r => `
        <div class="ai-review-item">
          <div class="ai-review-header">
            <span class="ai-review-user">${r.user}</span>
            <span class="ai-review-tag positive">好评</span>
          </div>
          <div class="ai-review-content">${r.content}</div>
        </div>
      `).join('');
    }
    
    function showNegativeReviews() {
      document.querySelectorAll('.ai-review-tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.ai-review-tab.negative').classList.add('active');
      document.getElementById('reviewsList').innerHTML = mockReviews.negative.map(r => `
        <div class="ai-review-item">
          <div class="ai-review-header">
            <span class="ai-review-user">${r.user}</span>
            <span class="ai-review-tag negative">差评</span>
          </div>
          <div class="ai-review-content">${r.content}</div>
        </div>
      `).join('');
    }
    
    function showCompareAnalysis() {
      const products = mockProducts.filter(p => p.name.includes('纸')).slice(0, 3);
      const html = `
        <div class="ai-section-title"><i class="fas fa-balance-scale"></i> 比质比价</div>
        <table class="ai-compare-table">
          <tr>
            <th>维度</th>
            ${products.map(p => `<th>${p.brand}</th>`).join('')}
          </tr>
          <tr>
            <td>价格</td>
            ${products.map((p, i) => `<td ${i === 2 ? 'class="highlight"' : ''}>¥${p.price.toFixed(2)}</td>`).join('')}
          </tr>
          <tr>
            <td>销量</td>
            ${products.map((p, i) => `<td ${i === 2 ? 'class="highlight"' : ''}>${p.sales}</td>`).join('')}
          </tr>
          <tr>
            <td>评分</td>
            ${products.map((p, i) => `<td ${i === 2 ? 'class="highlight"' : ''}>${p.score}</td>`).join('')}
          </tr>
        </table>
        <div style="text-align: center; padding: 16px; background: #f9fafb; border-radius: 10px; margin-bottom: 16px;">
          <div style="font-size: 12px; color: #9ca3af; margin-bottom: 8px;">综合评分雷达图</div>
          <svg width="140" height="140" viewBox="0 0 140 140">
            <polygon points="70,15 125,45 110,115 30,115 15,45" fill="none" stroke="#e5e7eb" stroke-width="1"/>
            <polygon points="70,35 100,55 90,100 50,100 40,55" fill="none" stroke="#e5e7eb" stroke-width="1"/>
            <polygon points="70,40 85,55 80,85 60,85 55,55" fill="rgba(16,185,129,0.2)" stroke="#10b981" stroke-width="2"/>
          </svg>
        </div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
          ${products.map((p, i) => `
            <button class="ai-btn-sm ${i === 2 ? 'primary' : 'secondary'}" onclick="addToCart(${p.id})">选${p.brand}</button>
          `).join('')}
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
    }
    
    function showOrderConfirm(productId, quantity) {
      const product = mockProducts.find(p => p.id === productId) || mockProducts[0];
      const total = (product.price * quantity).toFixed(2);
      const html = `
        <div class="ai-section-title"><i class="fas fa-shopping-cart"></i> 订单确认</div>
        <div class="ai-order-card">
          <div class="ai-order-card-header">
            <img src="${product.img}" class="ai-order-card-img" alt="">
            <div class="ai-order-card-info">
              <div class="ai-order-card-name">${product.name}</div>
              <div class="ai-order-card-meta">
                <span>单价：¥${product.price.toFixed(2)}/${product.unit}</span>
                <span>数量：${quantity}${product.unit}</span>
              </div>
            </div>
          </div>
          <div class="ai-order-card-total">
            <span>合计金额：</span>
            <strong>¥${total}</strong>
          </div>
          <button class="ai-order-btn" onclick="confirmOrder(${productId}, ${quantity})">
            <i class="fas fa-check"></i> 确认下单
          </button>
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
      addMessage(`即将为您创建订单，商品：${product.name}，数量：${quantity}${product.unit}，总价：¥${total}`, 'assistant');
    }
    
    function showProductDetail(name) {
      showProductAnalysis(name);
    }
    
    function showReviews(name) {
      showReviewsAnalysis();
    }
    
    function showCompare(name) {
      showCompareAnalysis();
    }
    
    function showOrder(name) {
      const product = mockProducts.find(p => p.name.includes(name.split(' ')[0])) || mockProducts[0];
      showOrderConfirm(product.id, 1);
    }
    
    // ==================== 操作函数 ====================
    
    function addToCart(productId) {
      const product = mockProducts.find(p => p.id === productId);
      if (product) {
        showToast(`已将「${product.name}」加入购物车`);
      }
    }
    
    function addToFavorite(productId) {
      const product = mockProducts.find(p => p.id === productId);
      if (product) {
        showToast(`已收藏「${product.name}」`);
      }
    }
    
    function confirmOrder(productId, quantity) {
      const product = mockProducts.find(p => p.id === productId);
      if (product) {
        showToast('订单创建成功，正在跳转...');
        addMessage(`<i class="fas fa-check-circle" style="color: #10b981;"></i> 订单创建成功！商品：${product.name}，数量：${quantity}${product.unit}`, 'assistant');
        setTimeout(() => clearAnalysis(), 1500);
      }
    }
    
    // Toast 提示
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2500);
    }
    
    // 底条 Tab 切换（购物车/我的收藏）
    function switchQuickTab(tab) {
      document.querySelectorAll('.ai-bottom-bar-tab').forEach(t => t.classList.remove('active'));
      var el = document.querySelector('.ai-bottom-bar-tab[data-tab="' + tab + '"]');
      if (el) el.classList.add('active');
      
      document.getElementById('favoritesTab').style.display = tab === 'favorites' ? 'flex' : 'none';
      document.getElementById('cartTab').style.display = tab === 'cart' ? 'flex' : 'none';
    }
    
    // 底条收起/展开
    function toggleBottomBar() {
      var bar = document.getElementById('aiBottomBar');
      var btn = document.getElementById('aiBottomBarToggle');
      if (!bar || !btn) return;
      var isCollapsed = bar.classList.toggle('collapsed');
      var icon = btn.querySelector('i');
      if (isCollapsed) {
        btn.innerHTML = '<i class="fas fa-chevron-up"></i> 展开';
      } else {
        btn.innerHTML = '<i class="fas fa-chevron-down"></i> 收起';
      }
    }
    
    // 初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 获取用户信息
      const role = localStorage.getItem('role') || 'buyer';
      const roleNames = {
        'guest': '访客',
        'buyer-user': '普通采购用户',
        'buyer': '采购专员',
        'supplier': '供应商',
        'admin': '平台管理员'
      };
      document.getElementById('userNameDisplay').textContent = `张三（${roleNames[role] || '采购专员'}）`;
    });
  </script>
</body>
</html>
