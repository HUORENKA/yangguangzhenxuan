<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI æ™ºèƒ½åŠ©æ‰‹ | é˜³å…‰ä¼˜é‡‡</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="../assets/custom.css">
  
  <style>
    :root {
      --color-primary: #E2231A;
      --color-primary-hover: #c01e16;
      --gradient-ai: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background: #f5f7fa;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    /* ==================== é¡¶éƒ¨å¯¼èˆª ==================== */
    .ai-header {
      background: var(--gradient-ai);
      color: #fff;
      padding: 0 24px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      box-shadow: 0 2px 12px rgba(102, 126, 234, 0.3);
    }
    
    .ai-header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .ai-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      color: #fff;
    }
    
    .ai-logo-icon {
      width: 36px;
      height: 36px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    .ai-logo-text {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 1px;
    }
    
    .ai-header-title {
      font-size: 15px;
      font-weight: 500;
      padding-left: 16px;
      border-left: 1px solid rgba(255,255,255,0.3);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ai-header-title i {
      font-size: 18px;
    }
    
    .ai-header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .ai-user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .ai-user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    /* ==================== ä¸»ä½“ä¸‰æ å¸ƒå±€ ==================== */
    .ai-main {
      flex: 1;
      display: flex;
      min-height: 0;
      padding: 16px;
      gap: 16px;
    }
    
    /* å·¦ä¾§ï¼šå¯¹è¯é¡µé¢ */
    .ai-chat-panel {
      flex: 0 0 35%;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .ai-panel-header {
      padding: 16px 20px;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
    }
    
    .ai-panel-header-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: var(--gradient-ai);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .ai-panel-header-text h3 {
      font-size: 15px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 2px;
    }
    
    .ai-panel-header-text p {
      font-size: 12px;
      color: #9ca3af;
    }
    
    .ai-chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .ai-message {
      display: flex;
      gap: 10px;
      max-width: 90%;
    }
    
    .ai-message.user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }
    
    .ai-message.assistant {
      align-self: flex-start;
    }
    
    .ai-message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .ai-message.user .ai-message-avatar {
      background: linear-gradient(135deg, #E2231A 0%, #ff6b6b 100%);
      color: #fff;
    }
    
    .ai-message.assistant .ai-message-avatar {
      background: var(--gradient-ai);
      color: #fff;
    }
    
    .ai-message-content {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .ai-message-bubble {
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.6;
      word-break: break-word;
    }
    
    .ai-message.user .ai-message-bubble {
      background: linear-gradient(135deg, #E2231A 0%, #c01e16 100%);
      color: #fff;
      border-bottom-right-radius: 4px;
    }
    
    .ai-message.assistant .ai-message-bubble {
      background: #f3f4f6;
      color: #374151;
      border-bottom-left-radius: 4px;
    }
    
    .ai-message-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .ai-option-btn {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      border: 1px solid #e5e7eb;
      background: #fff;
      color: #374151;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .ai-option-btn:hover {
      border-color: #667eea;
      color: #667eea;
      background: #f8f9ff;
    }
    
    .ai-chat-input {
      padding: 16px;
      border-top: 1px solid #f0f0f0;
      display: flex;
      gap: 12px;
      background: #fafafa;
    }
    
    .ai-chat-input input {
      flex: 1;
      height: 44px;
      padding: 0 18px;
      border: 1px solid #e5e7eb;
      border-radius: 22px;
      font-size: 14px;
      outline: none;
      transition: all 0.2s;
      background: #fff;
    }
    
    .ai-chat-input input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .ai-chat-input button {
      height: 44px;
      padding: 0 24px;
      border-radius: 22px;
      background: var(--gradient-ai);
      color: #fff;
      border: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .ai-chat-input button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    /* ä¸­é—´ï¼šæ™ºèƒ½åˆ†æé¡µ */
    .ai-analysis-panel {
      flex: 0 0 40%;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .ai-analysis-header {
      padding: 16px 20px;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(135deg, #f0fdf4 0%, #fff 100%);
    }
    
    .ai-analysis-header .ai-panel-header-icon {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    .ai-analysis-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    
    .ai-analysis-empty {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      text-align: center;
      padding: 40px;
    }
    
    .ai-analysis-empty-icon {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: #d1d5db;
      margin-bottom: 16px;
    }
    
    .ai-analysis-empty h4 {
      font-size: 16px;
      color: #6b7280;
      margin-bottom: 8px;
    }
    
    .ai-analysis-empty p {
      font-size: 13px;
      line-height: 1.6;
    }
    
    /* åˆ†æå†…å®¹ - å•†å“å¡ç‰‡ */
    .ai-product-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    .ai-product-card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px;
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .ai-product-card:hover {
      border-color: #10b981;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
      transform: translateY(-2px);
    }
    
    .ai-product-card-img {
      width: 100%;
      aspect-ratio: 4/3;
      object-fit: cover;
      border-radius: 8px;
      background: #f3f4f6;
      margin-bottom: 10px;
    }
    
    .ai-product-card-name {
      font-size: 13px;
      color: #1f2937;
      line-height: 1.4;
      margin-bottom: 6px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .ai-product-card-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .ai-product-card-price {
      font-size: 16px;
      color: #E2231A;
      font-weight: 600;
    }
    
    .ai-product-card-score {
      font-size: 12px;
      color: #6b7280;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .ai-product-card-score i {
      color: #fbbf24;
    }
    
    .ai-product-card-actions {
      display: flex;
      gap: 8px;
    }
    
    .ai-btn-sm {
      flex: 1;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }
    
    .ai-btn-sm.primary {
      background: #E2231A;
      color: #fff;
    }
    
    .ai-btn-sm.primary:hover {
      background: #c01e16;
    }
    
    .ai-btn-sm.secondary {
      background: #f3f4f6;
      color: #374151;
    }
    
    .ai-btn-sm.secondary:hover {
      background: #e5e7eb;
    }
    
    /* æ¯”ä»·è¡¨æ ¼ */
    .ai-compare-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-bottom: 16px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
    }
    
    .ai-compare-table th,
    .ai-compare-table td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .ai-compare-table th {
      background: linear-gradient(135deg, #f8f9ff 0%, #f3f4f6 100%);
      font-weight: 600;
      color: #374151;
    }
    
    .ai-compare-table td {
      color: #4b5563;
    }
    
    .ai-compare-table tr:last-child td {
      border-bottom: none;
    }
    
    .ai-compare-table .highlight {
      color: #10b981;
      font-weight: 600;
    }
    
    /* è¯„ä»·åˆ—è¡¨ */
    .ai-review-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .ai-review-tab {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .ai-review-tab.positive {
      background: #dcfce7;
      color: #166534;
    }
    
    .ai-review-tab.positive.active {
      background: #10b981;
      color: #fff;
    }
    
    .ai-review-tab.negative {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .ai-review-tab.negative.active {
      background: #ef4444;
      color: #fff;
    }
    
    .ai-review-item {
      padding: 12px;
      background: #f9fafb;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .ai-review-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .ai-review-user {
      font-size: 13px;
      color: #374151;
      font-weight: 500;
    }
    
    .ai-review-tag {
      padding: 2px 10px;
      border-radius: 10px;
      font-size: 11px;
    }
    
    .ai-review-tag.positive {
      background: #dcfce7;
      color: #166534;
    }
    
    .ai-review-tag.negative {
      background: #fee2e2;
      color: #991b1b;
    }
    
    .ai-review-content {
      font-size: 13px;
      color: #6b7280;
      line-height: 1.6;
    }
    
    /* å³ä¾§ï¼šå¿«æ·æ“ä½œé¡µ */
    .ai-quick-panel {
      flex: 0 0 25%;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .ai-quick-tabs {
      display: flex;
      border-bottom: 1px solid #f0f0f0;
      padding-top: 4px;
    }
    
    .ai-quick-tab {
      flex: 1;
      padding: 14px 16px;
      font-size: 14px;
      font-weight: 500;
      color: #6b7280;
      background: none;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .ai-quick-tab.active {
      color: #E2231A;
    }
    
    .ai-quick-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 3px;
      background: #E2231A;
      border-radius: 3px 3px 0 0;
    }
    
    .ai-quick-tab:hover:not(.active) {
      color: #374151;
      background: #f9fafb;
    }
    
    .ai-quick-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    
    .ai-quick-empty {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      text-align: center;
      padding: 40px 20px;
    }
    
    .ai-quick-empty-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #f3f4f6;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #d1d5db;
      margin-bottom: 12px;
    }
    
    .ai-quick-empty p {
      font-size: 13px;
    }
    
    /* å¿«æ·æ“ä½œå•†å“é¡¹ */
    .ai-quick-item {
      display: flex;
      gap: 12px;
      padding: 12px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      margin-bottom: 12px;
      transition: all 0.2s;
    }
    
    .ai-quick-item:hover {
      border-color: #f97316;
      box-shadow: 0 2px 8px rgba(249, 115, 22, 0.1);
    }
    
    .ai-quick-item-img {
      width: 64px;
      height: 64px;
      border-radius: 8px;
      object-fit: cover;
      background: #f3f4f6;
      flex-shrink: 0;
    }
    
    .ai-quick-item-info {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .ai-quick-item-name {
      font-size: 13px;
      color: #1f2937;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .ai-quick-item-bottom {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .ai-quick-item-price {
      font-size: 14px;
      color: #E2231A;
      font-weight: 600;
    }
    
    .ai-quick-item-send {
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
      background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .ai-quick-item-send:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(249, 115, 22, 0.3);
    }
    
    /* åŠ è½½åŠ¨ç”» */
    .ai-loading {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #9ca3af;
    }
    
    .ai-loading-dots {
      display: flex;
      gap: 4px;
    }
    
    .ai-loading-dots span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #667eea;
      animation: ai-bounce 1.4s infinite ease-in-out both;
    }
    
    .ai-loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .ai-loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes ai-bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }
    
    /* Toast æç¤º */
    .ai-toast {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      padding: 12px 24px;
      background: rgba(0,0,0,0.8);
      color: #fff;
      border-radius: 8px;
      font-size: 14px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .ai-toast.show {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }
    
    /* åˆ†æå†…å®¹æ ‡é¢˜ */
    .ai-section-title {
      font-size: 14px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ai-section-title i {
      color: #10b981;
    }
    
    /* é¢„ç®—æ ‡ç­¾ */
    .ai-budget-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: #dcfce7;
      color: #166534;
      font-size: 11px;
      border-radius: 12px;
      margin-bottom: 8px;
    }
    
    /* è¯„ä»·æ‘˜è¦ */
    .ai-review-summary {
      padding: 16px;
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      border-radius: 12px;
      margin-bottom: 16px;
    }
    
    .ai-review-summary-title {
      font-size: 14px;
      font-weight: 600;
      color: #166534;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ai-review-summary-content {
      font-size: 13px;
      color: #15803d;
      line-height: 1.6;
    }
    
    /* è®¢å•ç¡®è®¤å¡ç‰‡ */
    .ai-order-card {
      border: 2px solid #10b981;
      border-radius: 12px;
      padding: 16px;
      background: linear-gradient(135deg, #f0fdf4 0%, #fff 100%);
    }
    
    .ai-order-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 12px;
      border-bottom: 1px dashed #d1fae5;
      margin-bottom: 12px;
    }
    
    .ai-order-card-img {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      object-fit: cover;
      background: #f3f4f6;
    }
    
    .ai-order-card-info {
      flex: 1;
    }
    
    .ai-order-card-name {
      font-size: 14px;
      color: #1f2937;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    
    .ai-order-card-meta {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: #6b7280;
    }
    
    .ai-order-card-total {
      text-align: right;
      margin-bottom: 16px;
    }
    
    .ai-order-card-total span {
      font-size: 13px;
      color: #6b7280;
    }
    
    .ai-order-card-total strong {
      font-size: 20px;
      color: #E2231A;
      margin-left: 8px;
    }
    
    .ai-order-btn {
      width: 100%;
      padding: 14px;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .ai-order-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4);
    }
  </style>
</head>
<body>
  <!-- ==================== é¡¶éƒ¨å¯¼èˆª ==================== -->
  <header class="ai-header">
    <div class="ai-header-left">
      <a href="home.html" target="_blank" class="ai-logo">
        <div class="ai-logo-icon"><i class="fas fa-sun"></i></div>
        <span class="ai-logo-text">é˜³å…‰ä¼˜é‡‡</span>
      </a>
      <div class="ai-header-title">
        <i class="fas fa-robot"></i>
        AI æ™ºèƒ½åŠ©æ‰‹
      </div>
    </div>
    <div class="ai-header-right">
      <div class="ai-user-info">
        <div class="ai-user-avatar"><i class="fas fa-user"></i></div>
        <span id="userNameDisplay">å¼ ä¸‰ï¼ˆé‡‡è´­ä¸“å‘˜ï¼‰</span>
      </div>
    </div>
  </header>
  
  <!-- ==================== ä¸»ä½“ä¸‰æ å¸ƒå±€ ==================== -->
  <main class="ai-main">
    <!-- å·¦ä¾§ï¼šå¯¹è¯é¡µé¢ -->
    <section class="ai-chat-panel">
      <div class="ai-panel-header">
        <div class="ai-panel-header-icon"><i class="fas fa-comments"></i></div>
        <div class="ai-panel-header-text">
          <h3>æ™ºèƒ½å¯¹è¯</h3>
          <p>æœ‰é—®é¢˜éšæ—¶é—®æˆ‘</p>
        </div>
      </div>
      <div class="ai-chat-messages" id="chatMessages">
        <!-- æ¬¢è¿æ¶ˆæ¯ -->
        <div class="ai-message assistant">
          <div class="ai-message-avatar"><i class="fas fa-robot"></i></div>
          <div class="ai-message-content">
            <div class="ai-message-bubble">
              æ‚¨å¥½ï¼æˆ‘æ˜¯é˜³å…‰ä¼˜é‡‡æ™ºèƒ½åŠ©æ‰‹ ğŸ¤–<br><br>
              æˆ‘å¯ä»¥å¸®æ‚¨ï¼š<br>
              <strong>â€¢ æ‰¾å•†å“</strong>ï¼šæ¨èå•†å“ã€é¢„ç®—ç­›é€‰ã€æŸ¥çœ‹è¯„ä»·<br>
              <strong>â€¢ åšå†³ç­–</strong>ï¼šæ¯”è´¨æ¯”ä»·ã€æ”¶è—å•†å“ã€å¿«é€Ÿä¸‹å•<br>
              <strong>â€¢ è§£ç–‘é—®</strong>ï¼šå¹³å°è§„åˆ™å’¨è¯¢<br><br>
              è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„ï¼Ÿ
            </div>
            <div class="ai-message-options">
              <button class="ai-option-btn" onclick="sendQuickMsg('æœ‰æ²¡æœ‰å¥½ç”¨çš„å¤å°çº¸ï¼Ÿ')">æ‰¾å¤å°çº¸</button>
              <button class="ai-option-btn" onclick="sendQuickMsg('200å…ƒå†…é‡‡è´­10ç®±A4å¤å°çº¸')">é¢„ç®—å†…é‡‡è´­</button>
              <button class="ai-option-btn" onclick="sendQuickMsg('å•†å“å¦‚ä½•ç»“ç®—ï¼Ÿ')">è§„åˆ™å’¨è¯¢</button>
            </div>
          </div>
        </div>
      </div>
      <div class="ai-chat-input">
        <input type="text" id="chatInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..." onkeypress="if(event.key==='Enter')sendMessage()">
        <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i> å‘é€</button>
      </div>
    </section>
    
    <!-- ä¸­é—´ï¼šæ™ºèƒ½åˆ†æé¡µ -->
    <section class="ai-analysis-panel">
      <div class="ai-analysis-header">
        <div class="ai-panel-header-icon"><i class="fas fa-chart-line"></i></div>
        <div class="ai-panel-header-text">
          <h3>æ™ºèƒ½åˆ†æ</h3>
          <p>å•†å“æ¨èä¸æ•°æ®åˆ†æ</p>
        </div>
      </div>
      <div class="ai-analysis-content" id="analysisContent">
        <!-- ç©ºçŠ¶æ€ -->
        <div class="ai-analysis-empty" id="analysisEmpty">
          <div class="ai-analysis-empty-icon"><i class="fas fa-lightbulb"></i></div>
          <h4>ç­‰å¾…æ‚¨çš„æé—®</h4>
          <p>å‘ AI æé—®åï¼Œè¿™é‡Œå°†å±•ç¤º<br>ç›¸å…³å•†å“æ¨èå’Œæ•°æ®åˆ†æ</p>
        </div>
      </div>
    </section>
    
    <!-- å³ä¾§ï¼šå¿«æ·æ“ä½œé¡µ -->
    <section class="ai-quick-panel">
      <div class="ai-quick-tabs">
        <button class="ai-quick-tab active" data-tab="favorites" onclick="switchQuickTab('favorites')">
          <i class="fas fa-heart"></i> æˆ‘çš„æ”¶è—
        </button>
        <button class="ai-quick-tab" data-tab="cart" onclick="switchQuickTab('cart')">
          <i class="fas fa-shopping-cart"></i> è´­ç‰©è½¦
        </button>
      </div>
      <div class="ai-quick-content" id="quickContent">
        <!-- æ”¶è—åˆ—è¡¨ -->
        <div id="favoritesTab">
          <div class="ai-quick-item">
            <img src="https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=200&h=200&fit=crop" class="ai-quick-item-img" alt="">
            <div class="ai-quick-item-info">
              <div class="ai-quick-item-name">é½å¿ƒ C3674-5 A4å¤å°çº¸ 70g 500å¼ /åŒ…</div>
              <div class="ai-quick-item-bottom">
                <span class="ai-quick-item-price">Â¥25.92</span>
                <button class="ai-quick-item-send" onclick="sendProductQuery('é½å¿ƒ C3674-5 A4å¤å°çº¸')">å‘é€</button>
              </div>
            </div>
          </div>
          <div class="ai-quick-item">
            <img src="https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=200&h=200&fit=crop" class="ai-quick-item-img" alt="">
            <div class="ai-quick-item-info">
              <div class="ai-quick-item-name">å¤©ç« å¤å°çº¸ A4 80g ç™½è‰² 500å¼ /åŒ…</div>
              <div class="ai-quick-item-bottom">
                <span class="ai-quick-item-price">Â¥28.50</span>
                <button class="ai-quick-item-send" onclick="sendProductQuery('å¤©ç« å¤å°çº¸ A4 80g')">å‘é€</button>
              </div>
            </div>
          </div>
          <div class="ai-quick-item">
            <img src="https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=200&h=200&fit=crop" class="ai-quick-item-img" alt="">
            <div class="ai-quick-item-info">
              <div class="ai-quick-item-name">æ˜Ÿå®‡ åŠ³ä¿æ‰‹å¥— é˜²ç©¿åˆº é˜²æ»‘è€ç£¨</div>
              <div class="ai-quick-item-bottom">
                <span class="ai-quick-item-price">Â¥59.10</span>
                <button class="ai-quick-item-send" onclick="sendProductQuery('æ˜Ÿå®‡ åŠ³ä¿æ‰‹å¥—')">å‘é€</button>
              </div>
            </div>
          </div>
        </div>
        <!-- è´­ç‰©è½¦åˆ—è¡¨ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div id="cartTab" style="display: none;">
          <div class="ai-quick-item">
            <img src="https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=200&h=200&fit=crop" class="ai-quick-item-img" alt="">
            <div class="ai-quick-item-info">
              <div class="ai-quick-item-name">å¾—åŠ› A4å¤å°çº¸ 70g åŠå…¬ç”¨çº¸ 500å¼ /åŒ…</div>
              <div class="ai-quick-item-bottom">
                <span class="ai-quick-item-price">Â¥23.80 Ã— 5</span>
                <button class="ai-quick-item-send" onclick="sendProductQuery('å¾—åŠ› A4å¤å°çº¸')">å‘é€</button>
              </div>
            </div>
          </div>
          <div class="ai-quick-item">
            <img src="https://images.unsplash.com/photo-1582555172866-f73bb12a2ab3?w=200&h=200&fit=crop" class="ai-quick-item-img" alt="">
            <div class="ai-quick-item-info">
              <div class="ai-quick-item-name">å”ä¸° å®‰å…¨å¸½ ABS-Vå‹ è“è‰²</div>
              <div class="ai-quick-item-bottom">
                <span class="ai-quick-item-price">Â¥17.70 Ã— 10</span>
                <button class="ai-quick-item-send" onclick="sendProductQuery('å”ä¸° å®‰å…¨å¸½')">å‘é€</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <!-- Toast æç¤º -->
  <div class="ai-toast" id="toast"></div>
  
  <script>
    // ==================== Mock æ•°æ® ====================
    const mockProducts = [
      { id: 1, name: 'é½å¿ƒ C3674-5 A4å¤å°çº¸ 70g 500å¼ /åŒ…', brand: 'é½å¿ƒ', price: 25.92, unit: 'åŒ…', sales: 8520, score: 4.8, img: 'https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=400&h=300&fit=crop' },
      { id: 2, name: 'å¤©ç« å¤å°çº¸ A4 80g ç™½è‰² 500å¼ /åŒ…', brand: 'å¤©ç« ', price: 28.50, unit: 'åŒ…', sales: 6230, score: 4.7, img: 'https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=400&h=300&fit=crop' },
      { id: 3, name: 'å¾—åŠ› A4å¤å°çº¸ 70g åŠå…¬ç”¨çº¸ 500å¼ /åŒ…', brand: 'å¾—åŠ›', price: 23.80, unit: 'åŒ…', sales: 12350, score: 4.9, img: 'https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=400&h=300&fit=crop' },
      { id: 4, name: 'æ˜Ÿå®‡ åŠ³ä¿æ‰‹å¥— é˜²ç©¿åˆº é˜²æ»‘è€ç£¨', brand: 'æ˜Ÿå®‡', price: 59.10, unit: 'åŒ', sales: 3280, score: 4.6, img: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400&h=300&fit=crop' },
      { id: 5, name: 'å”ä¸° å®‰å…¨å¸½ ABS-Vå‹ è“è‰²', brand: 'å”ä¸°', price: 17.70, unit: 'é¡¶', sales: 5620, score: 4.5, img: 'https://images.unsplash.com/photo-1582555172866-f73bb12a2ab3?w=400&h=300&fit=crop' },
    ];
    
    const mockReviews = {
      positive: [
        { user: 'é‡‡è´­å‘˜å°æ', content: 'çº¸å¼ è´¨é‡å¾ˆå¥½ï¼Œæ‰“å°æ¸…æ™°ï¼Œç‰©æµå¾ˆå¿«ï¼' },
        { user: 'åŠå…¬å®¤ç‹ç»ç†', content: 'ä¸€ç›´ç”¨è¿™ä¸ªç‰Œå­ï¼Œæ€§ä»·æ¯”å¾ˆé«˜ï¼Œæ¨èï¼' },
        { user: 'å¼ å…ˆç”Ÿ', content: 'åŒ…è£…å®Œå¥½ï¼Œçº¸å¼ åšåº¦åˆé€‚ï¼Œéå¸¸æ»¡æ„ã€‚' },
      ],
      negative: [
        { user: 'åŒ¿åç”¨æˆ·', content: 'ç‰©æµæœ‰ç‚¹æ…¢ï¼Œç­‰äº†5å¤©æ‰åˆ°ã€‚' },
        { user: 'é‡‡è´­éƒ¨å°é™ˆ', content: 'æœ‰ä¸€åŒ…çº¸è¾¹è§’æœ‰ç‚¹ç ´æŸï¼Œå¸Œæœ›åŠ å¼ºåŒ…è£…ã€‚' },
      ]
    };
    
    // ==================== æ ¸å¿ƒå‡½æ•° ====================
    
    // å‘é€å¿«æ·æ¶ˆæ¯
    function sendQuickMsg(msg) {
      document.getElementById('chatInput').value = msg;
      sendMessage();
    }
    
    // å‘é€å•†å“æŸ¥è¯¢ï¼ˆä»å³ä¾§å¿«æ·æ“ä½œå‘é€ï¼‰
    function sendProductQuery(productName) {
      addMessage(productName, 'user');
      showLoading();
      
      setTimeout(() => {
        hideLoading();
        // AI å›å¤
        addMessageWithOptions(
          `å¥½çš„ï¼Œæˆ‘æ¥å¸®æ‚¨äº†è§£ã€Œ${productName}ã€è¿™æ¬¾å•†å“ã€‚è¯·é—®æ‚¨æƒ³ï¼š`,
          [
            { label: 'æŸ¥çœ‹å•†å“è¯¦æƒ…', action: `showProductDetail('${productName}')` },
            { label: 'æŸ¥çœ‹è¯„ä»·', action: `showReviews('${productName}')` },
            { label: 'ä¸å…¶ä»–å•†å“æ¯”ä»·', action: `showCompare('${productName}')` },
            { label: 'ç›´æ¥ä¸‹å•', action: `showOrder('${productName}')` },
          ]
        );
        // åœ¨åˆ†æåŒºæ˜¾ç¤ºå•†å“ä¿¡æ¯
        showProductAnalysis(productName);
      }, 600);
    }
    
    // å‘é€æ¶ˆæ¯
    function sendMessage() {
      const input = document.getElementById('chatInput');
      const msg = (input.value || '').trim();
      if (!msg) return;
      
      addMessage(msg, 'user');
      input.value = '';
      
      showLoading();
      
      setTimeout(() => {
        hideLoading();
        processMessage(msg);
      }, 800 + Math.random() * 400);
    }
    
    // æ·»åŠ æ¶ˆæ¯
    function addMessage(content, type) {
      const container = document.getElementById('chatMessages');
      const msgDiv = document.createElement('div');
      msgDiv.className = `ai-message ${type}`;
      
      const avatarIcon = type === 'user' ? 'fa-user' : 'fa-robot';
      
      msgDiv.innerHTML = `
        <div class="ai-message-avatar"><i class="fas ${avatarIcon}"></i></div>
        <div class="ai-message-content">
          <div class="ai-message-bubble">${content}</div>
        </div>
      `;
      
      container.appendChild(msgDiv);
      container.scrollTop = container.scrollHeight;
    }
    
    // æ·»åŠ å¸¦é€‰é¡¹çš„æ¶ˆæ¯
    function addMessageWithOptions(content, options) {
      const container = document.getElementById('chatMessages');
      const msgDiv = document.createElement('div');
      msgDiv.className = 'ai-message assistant';
      
      const optionsHtml = options.map(o => 
        `<button class="ai-option-btn" onclick="${o.action}">${o.label}</button>`
      ).join('');
      
      msgDiv.innerHTML = `
        <div class="ai-message-avatar"><i class="fas fa-robot"></i></div>
        <div class="ai-message-content">
          <div class="ai-message-bubble">${content}</div>
          <div class="ai-message-options">${optionsHtml}</div>
        </div>
      `;
      
      container.appendChild(msgDiv);
      container.scrollTop = container.scrollHeight;
    }
    
    // æ˜¾ç¤º/éšè—åŠ è½½
    function showLoading() {
      const container = document.getElementById('chatMessages');
      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'ai-message assistant';
      loadingDiv.id = 'loadingMsg';
      loadingDiv.innerHTML = `
        <div class="ai-message-avatar"><i class="fas fa-robot"></i></div>
        <div class="ai-message-content">
          <div class="ai-loading">
            <div class="ai-loading-dots"><span></span><span></span><span></span></div>
            <span>æ­£åœ¨æ€è€ƒ...</span>
          </div>
        </div>
      `;
      container.appendChild(loadingDiv);
      container.scrollTop = container.scrollHeight;
    }
    
    function hideLoading() {
      const loading = document.getElementById('loadingMsg');
      if (loading) loading.remove();
    }
    
    // å¤„ç†æ¶ˆæ¯
    function processMessage(msg) {
      const msgLower = msg.toLowerCase();
      
      // å•†å“æ¨è
      if (msgLower.includes('å¤å°çº¸') || msgLower.includes('æ‰“å°çº¸') || msgLower.includes('çº¸')) {
        addMessageWithOptions(
          'è¯·é—®æ‚¨éœ€è¦ä»€ä¹ˆè§„æ ¼çš„å¤å°çº¸ï¼Ÿ',
          [
            { label: 'A4 70g', action: "selectSpec('A4 70g')" },
            { label: 'A4 80g', action: "selectSpec('A4 80g')" },
            { label: 'A5 70g', action: "selectSpec('A5 70g')" },
          ]
        );
        return;
      }
      
      // é¢„ç®—ç­›é€‰
      if (msgLower.includes('å…ƒ') && (msgLower.includes('é‡‡è´­') || msgLower.includes('é¢„ç®—'))) {
        const budgetMatch = msg.match(/(\d+)\s*å…ƒ/);
        const budget = budgetMatch ? parseInt(budgetMatch[1]) : 200;
        addMessage(`ä¸ºæ‚¨æ‰¾åˆ°é¢„ç®— ${budget} å…ƒå†…çš„å•†å“ï¼Œè¯·æŸ¥çœ‹å³ä¾§åˆ†æåŒºåŸŸï¼š`, 'assistant');
        showBudgetProducts(budget);
        return;
      }
      
      // è¯„ä»·æŸ¥è¯¢
      if (msgLower.includes('è¯„ä»·') || msgLower.includes('å¥½è¯„') || msgLower.includes('å·®è¯„')) {
        addMessage('è¯¥å•†å“å¥½è¯„ç‡ <strong>92%</strong>ï¼Œè´Ÿé¢è¯„ä»·ä¸»è¦é›†ä¸­åœ¨ç‰©æµé€Ÿåº¦æ–¹é¢ã€‚è¯¦æƒ…è¯·çœ‹å³ä¾§åˆ†æåŒºåŸŸã€‚', 'assistant');
        showReviewsAnalysis();
        return;
      }
      
      // æ¯”ä»·
      if (msgLower.includes('æ¯”') || msgLower.includes('å¯¹æ¯”') || msgLower.includes('å“ªä¸ªæ›´å¥½')) {
        addMessage('æ ¹æ®å¯¹æ¯”åˆ†æï¼Œ<strong>å¾—åŠ› A4å¤å°çº¸</strong> åœ¨æ€§ä»·æ¯”æ–¹é¢è¡¨ç°æœ€ä½³ã€‚è¯¦æƒ…è¯·çœ‹å³ä¾§åˆ†æåŒºåŸŸã€‚', 'assistant');
        showCompareAnalysis();
        return;
      }
      
      // è§„åˆ™å’¨è¯¢
      if (msgLower.includes('ç»“ç®—') || msgLower.includes('ä»˜æ¬¾') || msgLower.includes('æ”¯ä»˜')) {
        addMessage(`<strong>å•†å“ç»“ç®—æ–¹å¼ï¼š</strong><br><br>
          <strong>1. åœ¨çº¿æ”¯ä»˜</strong><br>
          æ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€é“¶è”ç­‰å¤šç§æ”¯ä»˜æ–¹å¼ã€‚<br><br>
          <strong>2. å¯¹å…¬è½¬è´¦</strong><br>
          é€‚ç”¨äºä¼ä¸šå®¢æˆ·ï¼Œä¸‹å•åç”Ÿæˆå¯¹å…¬è´¦æˆ·ä¿¡æ¯ã€‚<br><br>
          <strong>3. è´¦æœŸç»“ç®—</strong><br>
          é€šè¿‡ä¿¡ç”¨è¯„ä¼°çš„ä¼ä¸šå®¢æˆ·å¯ç”³è¯·è´¦æœŸã€‚`, 'assistant');
        clearAnalysis();
        return;
      }
      
      if (msgLower.includes('é€€è´§') || msgLower.includes('é€€æ¢')) {
        addMessage(`<strong>é€€è´§è§„åˆ™è¯´æ˜ï¼š</strong><br><br>
          <strong>1. é€€è´§æ—¶é™</strong>ï¼šç­¾æ”¶å 7 å¤©å†…å¯ç”³è¯·æ— ç†ç”±é€€è´§<br><br>
          <strong>2. é€€è´§æ¡ä»¶</strong>ï¼šå•†å“éœ€ä¿æŒåŸåŒ…è£…å®Œå¥½<br><br>
          <strong>3. é€€æ¬¾æ—¶æ•ˆ</strong>ï¼šå®¡æ ¸é€šè¿‡å 3-5 ä¸ªå·¥ä½œæ—¥å†…åŸè·¯é€€å›`, 'assistant');
        clearAnalysis();
        return;
      }
      
      // é»˜è®¤å›å¤
      addMessageWithOptions(
        'æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰å®Œå…¨ç†è§£æ‚¨çš„é—®é¢˜ã€‚æ‚¨å¯ä»¥å°è¯•ä»¥ä¸‹æ“ä½œï¼š',
        [
          { label: 'æ‰¾å¤å°çº¸', action: "sendQuickMsg('æœ‰æ²¡æœ‰å¥½ç”¨çš„å¤å°çº¸ï¼Ÿ')" },
          { label: 'é¢„ç®—é‡‡è´­', action: "sendQuickMsg('200å…ƒå†…é‡‡è´­10ç®±A4å¤å°çº¸')" },
          { label: 'æŸ¥çœ‹è¯„ä»·', action: "sendQuickMsg('è¿™ä¸ªå•†å“è¯„ä»·æ€ä¹ˆæ ·ï¼Ÿ')" },
          { label: 'è§„åˆ™å’¨è¯¢', action: "sendQuickMsg('å•†å“å¦‚ä½•ç»“ç®—ï¼Ÿ')" },
        ]
      );
    }
    
    // é€‰æ‹©è§„æ ¼
    function selectSpec(spec) {
      addMessage(spec, 'user');
      setTimeout(() => {
        addMessage(`ä¸ºæ‚¨æ¨èä»¥ä¸‹ ${spec} å¤å°çº¸ï¼Œè¯·æŸ¥çœ‹å³ä¾§åˆ†æåŒºåŸŸï¼š`, 'assistant');
        showProductsAnalysis();
      }, 500);
    }
    
    // ==================== åˆ†æåŒºæ˜¾ç¤ºå‡½æ•° ====================
    
    function clearAnalysis() {
      document.getElementById('analysisContent').innerHTML = `
        <div class="ai-analysis-empty" id="analysisEmpty">
          <div class="ai-analysis-empty-icon"><i class="fas fa-lightbulb"></i></div>
          <h4>ç­‰å¾…æ‚¨çš„æé—®</h4>
          <p>å‘ AI æé—®åï¼Œè¿™é‡Œå°†å±•ç¤º<br>ç›¸å…³å•†å“æ¨èå’Œæ•°æ®åˆ†æ</p>
        </div>
      `;
    }
    
    function showProductsAnalysis() {
      const products = mockProducts.filter(p => p.name.includes('çº¸')).slice(0, 4);
      const html = `
        <div class="ai-section-title"><i class="fas fa-box-open"></i> æ¨èå•†å“</div>
        <div class="ai-product-grid">
          ${products.map(p => `
            <div class="ai-product-card" onclick="showProductDetail('${p.name}')">
              <img src="${p.img}" class="ai-product-card-img" alt="">
              <div class="ai-product-card-name">${p.name}</div>
              <div class="ai-product-card-meta">
                <span class="ai-product-card-price">Â¥${p.price.toFixed(2)}</span>
                <span class="ai-product-card-score"><i class="fas fa-star"></i> ${p.score}</span>
              </div>
              <div class="ai-product-card-actions">
                <button class="ai-btn-sm primary" onclick="event.stopPropagation();addToCart(${p.id})"><i class="fas fa-cart-plus"></i> åŠ è´­</button>
                <button class="ai-btn-sm secondary" onclick="event.stopPropagation();addToFavorite(${p.id})"><i class="fas fa-heart"></i></button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
    }
    
    function showProductAnalysis(productName) {
      const product = mockProducts.find(p => p.name.includes(productName.split(' ')[0])) || mockProducts[0];
      const html = `
        <div class="ai-section-title"><i class="fas fa-info-circle"></i> å•†å“ä¿¡æ¯</div>
        <div class="ai-product-card" style="margin-bottom: 16px;">
          <img src="${product.img}" class="ai-product-card-img" alt="">
          <div class="ai-product-card-name">${product.name}</div>
          <div class="ai-product-card-meta">
            <span class="ai-product-card-price">Â¥${product.price.toFixed(2)}/${product.unit}</span>
            <span class="ai-product-card-score"><i class="fas fa-star"></i> ${product.score} | é”€é‡ ${product.sales}</span>
          </div>
          <div class="ai-product-card-actions">
            <button class="ai-btn-sm primary" onclick="addToCart(${product.id})"><i class="fas fa-cart-plus"></i> åŠ å…¥è´­ç‰©è½¦</button>
            <button class="ai-btn-sm secondary" onclick="addToFavorite(${product.id})"><i class="fas fa-heart"></i> æ”¶è—</button>
          </div>
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
    }
    
    function showBudgetProducts(budget) {
      const products = mockProducts.filter(p => p.price * 10 <= budget).slice(0, 4);
      const html = `
        <div class="ai-section-title"><i class="fas fa-wallet"></i> é¢„ç®—å†…å•†å“</div>
        <div class="ai-product-grid">
          ${products.map(p => `
            <div class="ai-product-card">
              <div class="ai-budget-tag"><i class="fas fa-check-circle"></i> é¢„ç®—å†…</div>
              <img src="${p.img}" class="ai-product-card-img" alt="">
              <div class="ai-product-card-name">${p.name}</div>
              <div class="ai-product-card-meta">
                <span class="ai-product-card-price">Â¥${p.price.toFixed(2)}</span>
                <span class="ai-product-card-score">10ç®± Â¥${(p.price * 10).toFixed(2)}</span>
              </div>
              <div class="ai-product-card-actions">
                <button class="ai-btn-sm primary" onclick="showOrderConfirm(${p.id}, 10)"><i class="fas fa-bolt"></i> ä¸€é”®ä¸‹å•</button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
    }
    
    function showReviewsAnalysis() {
      const html = `
        <div class="ai-section-title"><i class="fas fa-star"></i> å•†å“è¯„ä»·</div>
        <div class="ai-review-summary">
          <div class="ai-review-summary-title"><i class="fas fa-chart-pie"></i> è¯„ä»·æ‘˜è¦</div>
          <div class="ai-review-summary-content">å¥½è¯„ç‡ <strong>92%</strong>ï¼Œè´Ÿé¢è¯„ä»·ä¸»è¦é›†ä¸­åœ¨ç‰©æµé€Ÿåº¦æ–¹é¢ã€‚æ•´ä½“è´¨é‡ç¨³å®šï¼Œå€¼å¾—æ¨èã€‚</div>
        </div>
        <div class="ai-review-tabs">
          <button class="ai-review-tab positive active" onclick="showPositiveReviews()">å¥½è¯„ (${mockReviews.positive.length})</button>
          <button class="ai-review-tab negative" onclick="showNegativeReviews()">å·®è¯„ (${mockReviews.negative.length})</button>
        </div>
        <div id="reviewsList">
          ${mockReviews.positive.map(r => `
            <div class="ai-review-item">
              <div class="ai-review-header">
                <span class="ai-review-user">${r.user}</span>
                <span class="ai-review-tag positive">å¥½è¯„</span>
              </div>
              <div class="ai-review-content">${r.content}</div>
            </div>
          `).join('')}
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
    }
    
    function showPositiveReviews() {
      document.querySelectorAll('.ai-review-tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.ai-review-tab.positive').classList.add('active');
      document.getElementById('reviewsList').innerHTML = mockReviews.positive.map(r => `
        <div class="ai-review-item">
          <div class="ai-review-header">
            <span class="ai-review-user">${r.user}</span>
            <span class="ai-review-tag positive">å¥½è¯„</span>
          </div>
          <div class="ai-review-content">${r.content}</div>
        </div>
      `).join('');
    }
    
    function showNegativeReviews() {
      document.querySelectorAll('.ai-review-tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.ai-review-tab.negative').classList.add('active');
      document.getElementById('reviewsList').innerHTML = mockReviews.negative.map(r => `
        <div class="ai-review-item">
          <div class="ai-review-header">
            <span class="ai-review-user">${r.user}</span>
            <span class="ai-review-tag negative">å·®è¯„</span>
          </div>
          <div class="ai-review-content">${r.content}</div>
        </div>
      `).join('');
    }
    
    function showCompareAnalysis() {
      const products = mockProducts.filter(p => p.name.includes('çº¸')).slice(0, 3);
      const html = `
        <div class="ai-section-title"><i class="fas fa-balance-scale"></i> æ¯”è´¨æ¯”ä»·</div>
        <table class="ai-compare-table">
          <tr>
            <th>ç»´åº¦</th>
            ${products.map(p => `<th>${p.brand}</th>`).join('')}
          </tr>
          <tr>
            <td>ä»·æ ¼</td>
            ${products.map((p, i) => `<td ${i === 2 ? 'class="highlight"' : ''}>Â¥${p.price.toFixed(2)}</td>`).join('')}
          </tr>
          <tr>
            <td>é”€é‡</td>
            ${products.map((p, i) => `<td ${i === 2 ? 'class="highlight"' : ''}>${p.sales}</td>`).join('')}
          </tr>
          <tr>
            <td>è¯„åˆ†</td>
            ${products.map((p, i) => `<td ${i === 2 ? 'class="highlight"' : ''}>${p.score}</td>`).join('')}
          </tr>
        </table>
        <div style="text-align: center; padding: 16px; background: #f9fafb; border-radius: 10px; margin-bottom: 16px;">
          <div style="font-size: 12px; color: #9ca3af; margin-bottom: 8px;">ç»¼åˆè¯„åˆ†é›·è¾¾å›¾</div>
          <svg width="140" height="140" viewBox="0 0 140 140">
            <polygon points="70,15 125,45 110,115 30,115 15,45" fill="none" stroke="#e5e7eb" stroke-width="1"/>
            <polygon points="70,35 100,55 90,100 50,100 40,55" fill="none" stroke="#e5e7eb" stroke-width="1"/>
            <polygon points="70,40 85,55 80,85 60,85 55,55" fill="rgba(16,185,129,0.2)" stroke="#10b981" stroke-width="2"/>
          </svg>
        </div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
          ${products.map((p, i) => `
            <button class="ai-btn-sm ${i === 2 ? 'primary' : 'secondary'}" onclick="addToCart(${p.id})">é€‰${p.brand}</button>
          `).join('')}
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
    }
    
    function showOrderConfirm(productId, quantity) {
      const product = mockProducts.find(p => p.id === productId) || mockProducts[0];
      const total = (product.price * quantity).toFixed(2);
      const html = `
        <div class="ai-section-title"><i class="fas fa-shopping-cart"></i> è®¢å•ç¡®è®¤</div>
        <div class="ai-order-card">
          <div class="ai-order-card-header">
            <img src="${product.img}" class="ai-order-card-img" alt="">
            <div class="ai-order-card-info">
              <div class="ai-order-card-name">${product.name}</div>
              <div class="ai-order-card-meta">
                <span>å•ä»·ï¼šÂ¥${product.price.toFixed(2)}/${product.unit}</span>
                <span>æ•°é‡ï¼š${quantity}${product.unit}</span>
              </div>
            </div>
          </div>
          <div class="ai-order-card-total">
            <span>åˆè®¡é‡‘é¢ï¼š</span>
            <strong>Â¥${total}</strong>
          </div>
          <button class="ai-order-btn" onclick="confirmOrder(${productId}, ${quantity})">
            <i class="fas fa-check"></i> ç¡®è®¤ä¸‹å•
          </button>
        </div>
      `;
      document.getElementById('analysisContent').innerHTML = html;
      addMessage(`å³å°†ä¸ºæ‚¨åˆ›å»ºè®¢å•ï¼Œå•†å“ï¼š${product.name}ï¼Œæ•°é‡ï¼š${quantity}${product.unit}ï¼Œæ€»ä»·ï¼šÂ¥${total}`, 'assistant');
    }
    
    function showProductDetail(name) {
      showProductAnalysis(name);
    }
    
    function showReviews(name) {
      showReviewsAnalysis();
    }
    
    function showCompare(name) {
      showCompareAnalysis();
    }
    
    function showOrder(name) {
      const product = mockProducts.find(p => p.name.includes(name.split(' ')[0])) || mockProducts[0];
      showOrderConfirm(product.id, 1);
    }
    
    // ==================== æ“ä½œå‡½æ•° ====================
    
    function addToCart(productId) {
      const product = mockProducts.find(p => p.id === productId);
      if (product) {
        showToast(`å·²å°†ã€Œ${product.name}ã€åŠ å…¥è´­ç‰©è½¦`);
      }
    }
    
    function addToFavorite(productId) {
      const product = mockProducts.find(p => p.id === productId);
      if (product) {
        showToast(`å·²æ”¶è—ã€Œ${product.name}ã€`);
      }
    }
    
    function confirmOrder(productId, quantity) {
      const product = mockProducts.find(p => p.id === productId);
      if (product) {
        showToast('è®¢å•åˆ›å»ºæˆåŠŸï¼Œæ­£åœ¨è·³è½¬...');
        addMessage(`<i class="fas fa-check-circle" style="color: #10b981;"></i> è®¢å•åˆ›å»ºæˆåŠŸï¼å•†å“ï¼š${product.name}ï¼Œæ•°é‡ï¼š${quantity}${product.unit}`, 'assistant');
        setTimeout(() => clearAnalysis(), 1500);
      }
    }
    
    // Toast æç¤º
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2500);
    }
    
    // å¿«æ·æ“ä½œ Tab åˆ‡æ¢
    function switchQuickTab(tab) {
      document.querySelectorAll('.ai-quick-tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`.ai-quick-tab[data-tab="${tab}"]`).classList.add('active');
      
      document.getElementById('favoritesTab').style.display = tab === 'favorites' ? 'block' : 'none';
      document.getElementById('cartTab').style.display = tab === 'cart' ? 'block' : 'none';
    }
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // è·å–ç”¨æˆ·ä¿¡æ¯
      const role = localStorage.getItem('role') || 'buyer';
      const roleNames = {
        'guest': 'è®¿å®¢',
        'buyer-user': 'æ™®é€šé‡‡è´­ç”¨æˆ·',
        'buyer': 'é‡‡è´­ä¸“å‘˜',
        'supplier': 'ä¾›åº”å•†',
        'admin': 'å¹³å°ç®¡ç†å‘˜'
      };
      document.getElementById('userNameDisplay').textContent = `å¼ ä¸‰ï¼ˆ${roleNames[role] || 'é‡‡è´­ä¸“å‘˜'}ï¼‰`;
    });
  </script>
</body>
</html>
